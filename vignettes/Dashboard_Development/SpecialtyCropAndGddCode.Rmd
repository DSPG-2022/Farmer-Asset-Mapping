---
title: "Developing Specialty Crop Data and Calculating GDDs"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Developing Specialty Crop Data and Calculating GDDs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
```

```{r, eval=FALSE}
library(dplyr)
library(tidyr)
library(tidyverse)
library(tidycensus)
library(dplyr)
library(ggplot2)
```


# Data

### Loaded the weather data. Data was retrieved from [**Iowa Mesonet Reanalysis Tool (IEMRE)**](https://mesonet.agron.iastate.edu/iemre/)

```{r model-function, eval=FALSE}
mydata <- read.csv("2015_2021_clim.csv")
View(mydata)
```

### Loaded the specialty crop dataset as a csv 
### Retrieved the data and information from the *2022-Midwest-Veg-Guide* and the *Donald N. Maynard, George J. Hochmuth -Knott's Handbook forVegetable Growers-Wiley*

### Snippet of the dataset
![This is an image](https://github.com/DSPG-2022/Farmer-Asset-Mapping/blob/main/man/figures/crop_ss.png)

```{r model-function1, eval=FALSE}
newdata <- read.csv("Crop-Info_Farmer Asset Mapping.csv")
View(newdata)
```

# Cleaning the Data
### Dropping certain columns and removing rows with no data, for easy and clear visualization

```{r model-function2, eval=FALSE}
new_data <- newdata[-c(20:38), ] 
View(new_data)

new_data <- subset(new_data, select = -c(`Type.of.Irrigation`,`Precipitation`, `X`, `X.1`))
  
mydata = subset(mydata, select = -c(`mrms_precip_in`,`prism_precip_in`,`X12z_high_f`,`climate_daily_high_f`,`X12z_low_f`,`climate_daily_low_f`,`daily_precip_in`,`X12z_precip_in`,`climate_daily_precip_in` ) )
```
# Calculations
### Calculating the average temperatures of the days from 2015-2021

```{r model-function3, eval=FALSE}
mydata$Average_temp = (mydata$daily_high_f + mydata$daily_low_f)/2

View(mydata)
```

### Calculating the Growing Degree Days 
- The calculations are made by subtracting the Base Temperatures of the crops from the Mean Temperature of the Day.

```{r model-function4, eval=FALSE}
mydata$OnionGDD <- mydata$Average_temp - 40

mydata$PeasGDD <- mydata$Average_temp - 39

mydata$AsparagusGDD <- mydata$Average_temp - 50

mydata$PotatoGDD <- mydata$Average_temp - 32

mydata$CabbageGDD <- mydata$Average_temp - 40

mydata$Sweet_PotatoGDD <- mydata$Average_temp - 65

mydata$SquashGDD <- mydata$Average_temp - 60

mydata$CucumberGDD <- mydata$Average_temp - 60

mydata$CauliflowerGDD <- mydata$Average_temp - 40

mydata$PumpkinGDD <- mydata$Average_temp - 60

mydata$TomatoGDD <- mydata$Average_temp - 50

mydata$WatermelonGDD <- mydata$Average_temp - 50

mydata$CarrotGDD <- mydata$Average_temp - 40

mydata$Sweet_cornGDD <- mydata$Average_temp - 50

mydata$LettuceGDD <- mydata$Average_temp - 40

mydata$EggplantGDD <- mydata$Average_temp - 50

mydata$RadishGDD <- mydata$Average_temp - 40

mydata$SpinachGDD <- mydata$Average_temp - 35

mydata$CantaloupeGDD <- mydata$Average_temp - 65

View(mydata)
``` 
### If Average Temperature of the day is lesser than the Base Temperature, then GDD = 0

```{r model-function4, eval=FALSE}
mydata$OnionGDD= ifelse(mydata$OnionGDD < 0, "0", mydata$OnionGDD)
mydata$PeasGDD= ifelse(mydata$PeasGDD < 0, "0",mydata$PeasGDD )
mydata$AsparagusGDD= ifelse(mydata$AsparagusGDD < 0, "0", mydata$AsparagusGDD )
mydata$PotatoGDD= ifelse(mydata$PotatoGDD < 0, "0", mydata$PotatoGDD )
mydata$CabbageGDD= ifelse(mydata$CabbageGDD < 0, "0",mydata$CabbageGDD )
mydata$Sweet_PotatoGDD= ifelse(mydata$Sweet_PotatoGDD < 0, "0",mydata$Sweet_PotatoGDD )
mydata$SquashGDD= ifelse(mydata$SquashGDD < 0, "0",mydata$SquashGDD )
mydata$CucumberGDD= ifelse( mydata$CucumberGDD< 0, "0",mydata$CucumberGDD )
mydata$CauliflowerGDD= ifelse(mydata$CauliflowerGDD < 0, "0", mydata$CauliflowerGDD)
mydata$PumpkinGDD= ifelse(mydata$PumpkinGDD < 0, "0",mydata$PumpkinGDD )
mydata$TomatoGDD= ifelse( mydata$TomatoGDD< 0, "0",mydata$TomatoGDD )
mydata$WatermelonGDD= ifelse(mydata$WatermelonGDD < 0, "0",mydata$WatermelonGDD )
mydata$CarrotGDD= ifelse( mydata$CarrotGDD< 0, "0",mydata$CarrotGDD )
mydata$Sweet_cornGDD= ifelse(mydata$Sweet_cornGDD < 0, "0",mydata$Sweet_cornGDD )
mydata$LettuceGDD= ifelse(mydata$LettuceGDD < 0, "0",mydata$LettuceGDD )
mydata$EggplantGDD= ifelse(mydata$EggplantGDD < 0, "0",mydata$EggplantGDD )
mydata$RadishGDD= ifelse(mydata$RadishGDD < 0, "0",mydata$RadishGDD )
mydata$SpinachGDD= ifelse(mydata$SpinachGDD < 0, "0",mydata$SpinachGDD )
mydata$CantaloupeGDD= ifelse(mydata$CantaloupeGDD < 0, "0",mydata$CantaloupeGDD )

View(mydata)
glimpse(mydata)
```
### Seperating the Months and Years, in order to group data by the Year
```{r, eval=FALSE}
mydata2 <- mydata %>% mutate(Month = substr(date,0,1), year= substr(date, (nchar(date)-3), nchar(date))) %>% mutate(Month = ifelse(Month ==1,10,Month))%>% group_by(year, Month) %>% summarise(acc_gdd_onion= sum(as.numeric(OnionGDD)),acc_gdd_peas = sum(as.numeric(PeasGDD)), acc_gdd_asparaguss = sum(as.numeric(AsparagusGDD)), acc_gdd_potato = sum(as.numeric(PotatoGDD)), acc_gdd_cabbage = sum(as.numeric(CabbageGDD)), acc_gdd_sweet_potato = sum(as.numeric(Sweet_PotatoGDD)), acc_gdd_Squash = sum(as.numeric(SquashGDD)), acc_gdd_cucumber = sum(as.numeric(CucumberGDD)), acc_gdd_Cauliflower = sum(as.numeric(CauliflowerGDD)), acc_gdd_Pumpkin = sum(as.numeric(PumpkinGDD)), acc_gdd_Tomato = sum(as.numeric(TomatoGDD)), acc_gdd_Watermelon = sum(as.numeric(WatermelonGDD)), acc_gdd_carrot = sum(as.numeric(CarrotGDD)), acc_gdd_sweet_corn = sum(as.numeric(Sweet_cornGDD)), acc_gdd_lettuce = sum(as.numeric(LettuceGDD)), acc_gdd_Eggplant = sum(as.numeric(EggplantGDD)), acc_gdd_radish = sum(as.numeric(RadishGDD)), acc_gdd_spinach = sum(as.numeric(SpinachGDD)), acc_gdd_cantaloupe = sum(as.numeric(CantaloupeGDD)))
```

### Specifying the target months, and formatting the dates clearly

```{r, eval=FALSE}
mydata2<- mydata2 %>%
  mutate(Date = paste(Month,year,sep="/"))
 
mydata2$Month = ifelse(mydata2$Month == 4,"April",
                       ifelse(mydata2$Month == 5, "May",
                              ifelse(mydata2$Month == 6, "June",
                                     ifelse(mydata2$Month == 7, "July",
                                            ifelse(mydata2$Month == 8, "August",
                                                   ifelse(mydata2$Month == 9, "September",
                                                          ifelse(mydata2$Month == 10,"October", mydata2$Month))))))) 

                                                                                                                                                                                                                                                                                               
View(mydata2)
```  


### Saving the data as a csv file to the local directory

```{r, eval=FALSE}
write.csv(mydata2, "S:/misc/clg/DSPG2022/ProjectB/Speciality_Crops_GDD_cleaned_2015-2021.csv", row.names = FALSE)
```
